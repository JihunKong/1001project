# 1001 Stories - í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§ ë° ë³´ì•ˆ ì‹œìŠ¤í…œ

## ğŸ“‹ ê°œìš”

ì´ ë””ë ‰í† ë¦¬ëŠ” 1001 Stories í”„ë¡œë•ì…˜ í™˜ê²½ì˜ ëª¨ë‹ˆí„°ë§, ë°±ì—…, ë³´ì•ˆ, ë°°í¬ ìë™í™”ë¥¼ ìœ„í•œ ì™„ì „í•œ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ êµ¬ì„±

### ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Prometheus    â”‚â—„â”€â”€â”€â”¤  Node Exporter  â”‚    â”‚   BlackBox      â”‚
â”‚   (ë©”íŠ¸ë¦­ ìˆ˜ì§‘)   â”‚    â”‚  (ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­)  â”‚    â”‚  (HTTP í”„ë¡œë¸Œ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                        â–²                        â–²
         â”‚                        â”‚                        â”‚
         â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Grafana      â”‚    â”‚   Alertmanager  â”‚    â”‚  Uptime Kuma    â”‚
â”‚   (ëŒ€ì‹œë³´ë“œ)      â”‚    â”‚   (ì•Œë¦¼ ê´€ë¦¬)    â”‚    â”‚ (ì—…íƒ€ì„ ëª¨ë‹ˆí„°ë§) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¡œê·¸ ê´€ë¦¬
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Promtail     â”‚â”€â”€â”€â–ºâ”‚      Loki       â”‚â—„â”€â”€â”€â”¤    Grafana      â”‚
â”‚   (ë¡œê·¸ ìˆ˜ì§‘)     â”‚    â”‚   (ë¡œê·¸ ì €ì¥)    â”‚    â”‚  (ë¡œê·¸ ì‹œê°í™”)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
monitoring/
â”œâ”€â”€ README.md                          # ì´ ë¬¸ì„œ
â”œâ”€â”€ docker-compose.monitoring.yml      # ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ Docker Compose
â”œâ”€â”€ prometheus.yml                     # Prometheus ì„¤ì •
â”œâ”€â”€ alertmanager.yml                   # Alertmanager ì•Œë¦¼ ì„¤ì •
â”œâ”€â”€ prometheus-rules/
â”‚   â””â”€â”€ 1001stories.yml               # ì•Œë¦¼ ê·œì¹™ ì •ì˜
â”œâ”€â”€ health-check.sh                    # í—¬ìŠ¤ì²´í¬ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ backup-database.sh                 # ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ deploy-enhanced.sh                 # í–¥ìƒëœ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ security-hardening.sh             # ë³´ì•ˆ ê°•í™” ìŠ¤í¬ë¦½íŠ¸
```

## ğŸš€ ì„¤ì¹˜ ë° ì„¤ì •

### 1. ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ë°°í¬

```bash
# ëª¨ë‹ˆí„°ë§ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd monitoring/

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ í•„ìš”í•œ ê°’ë“¤ì„ ì„¤ì •í•˜ì„¸ìš”

# ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹œì‘
docker-compose -f docker-compose.monitoring.yml up -d

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose -f docker-compose.monitoring.yml ps
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì— ë‹¤ìŒ ë³€ìˆ˜ë“¤ì„ ì„¤ì •í•˜ì„¸ìš”:

```env
# Grafana ì„¤ì •
GRAFANA_PASSWORD=your-secure-password

# ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •
SMTP_HOST=smtp.gmail.com:587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=alerts@1001stories.org

# Slack ì•Œë¦¼ (ì„ íƒì‚¬í•­)
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...

# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì„¤ì •
DB_HOST=localhost
DB_PORT=5432
DB_NAME=1001stories
DB_USER=postgres
PGPASSWORD=your-db-password

# AWS S3 ë°±ì—… (ì„ íƒì‚¬í•­)
S3_BUCKET=1001stories-backups
```

### 3. í—¬ìŠ¤ì²´í¬ ë° ë°±ì—… ìë™í™”

```bash
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x health-check.sh backup-database.sh

# ìˆ˜ë™ í…ŒìŠ¤íŠ¸
./health-check.sh
./backup-database.sh

# Cron ì‘ì—… ë“±ë¡
crontab -e

# ë‹¤ìŒ ë¼ì¸ë“¤ì„ ì¶”ê°€:
*/5 * * * * /opt/monitoring/health-check.sh >> /var/log/health-check.log 2>&1
0 2 * * * /opt/monitoring/backup-database.sh >> /var/log/backup.log 2>&1
0 3 * * 0 RESTORE_TEST=true /opt/monitoring/backup-database.sh >> /var/log/backup.log 2>&1
```

## ğŸ”’ ë³´ì•ˆ ê°•í™”

### ì„œë²„ ë³´ì•ˆ ì„¤ì •

```bash
# ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
sudo ./security-hardening.sh

# ì£¼ìš” ë³´ì•ˆ ê°•í™” ì‚¬í•­:
# - UFW ë°©í™”ë²½ ì„¤ì •
# - Fail2Ban ì¹¨ì… ë°©ì§€
# - SSH ë³´ì•ˆ ê°•í™”
# - ìë™ ë³´ì•ˆ ì—…ë°ì´íŠ¸
# - ì‹œìŠ¤í…œ ê°ì‚¬ (auditd)
# - íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ (AIDE)
# - AppArmor ë³´ì•ˆ í”„ë¡œí•„
# - Docker ë³´ì•ˆ ì„¤ì •
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

### ì ‘ì† ì •ë³´
- **Grafana**: `http://your-server:3001`
  - ì‚¬ìš©ì: `admin`
  - ë¹„ë°€ë²ˆí˜¸: `.env` íŒŒì¼ì˜ `GRAFANA_PASSWORD`

- **Prometheus**: `http://your-server:9090`
- **Alertmanager**: `http://your-server:9093`
- **Uptime Kuma**: `http://your-server:3002`

### ì£¼ìš” ë©”íŠ¸ë¦­

#### ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­
- CPU ì‚¬ìš©ë¥ 
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
- ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
- ë„¤íŠ¸ì›Œí¬ I/O
- ë¡œë“œ ì• ë²„ë¦¬ì§€

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­
- HTTP ì‘ë‹µ ì‹œê°„
- ì—ëŸ¬ìœ¨
- ì²˜ë¦¬ëŸ‰ (RPS)
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìˆ˜
- ì»¨í…Œì´ë„ˆ ìƒíƒœ

#### ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­
- ì‚¬ìš©ì ë“±ë¡ ìˆ˜
- ìŠ¤í† ë¦¬ ì—…ë¡œë“œ ìˆ˜
- ê²°ì œ ì„±ê³µë¥ 
- í˜ì´ì§€ ë·°

## ğŸš¨ ì•Œë¦¼ ì‹œìŠ¤í…œ

### ì•Œë¦¼ ê·œì¹™

#### ì¤‘ìš”ë„ë³„ ë¶„ë¥˜
- **Critical**: ì¦‰ì‹œ ëŒ€ì‘ í•„ìš” (ì„œë¹„ìŠ¤ ë‹¤ìš´, ë°ì´í„°ë² ì´ìŠ¤ ì¥ì• )
- **Warning**: ì£¼ì˜ í•„ìš” (ë†’ì€ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰, ëŠë¦° ì‘ë‹µ)
- **Info**: ì •ë³´ì„± ì•Œë¦¼ (ë°°í¬ ì™„ë£Œ, ë°±ì—… ì™„ë£Œ)

#### ì•Œë¦¼ ì±„ë„
- ì´ë©”ì¼: ëª¨ë“  ì•Œë¦¼
- Slack: ì¤‘ìš” ì•Œë¦¼ (ì„¤ì • ì‹œ)
- SMS: ì¹˜ëª…ì  ì•Œë¦¼ (ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ í•„ìš”)

### ì•Œë¦¼ ì„¤ì •

```yaml
# alertmanager.ymlì—ì„œ ì„¤ì •
receivers:
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@1001stories.org'
        subject: '[CRITICAL] 1001 Stories Alert'
```

## ğŸ’¾ ë°±ì—… ì‹œìŠ¤í…œ

### ë°±ì—… ì „ëµ

#### ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
- **ë¹ˆë„**: ë§¤ì¼ ìƒˆë²½ 2ì‹œ
- **ë³´ì¡´ ê¸°ê°„**: 30ì¼
- **ìœ„ì¹˜**: ë¡œì»¬ + S3 (ì„ íƒì‚¬í•­)
- **ì••ì¶•**: gzip
- **ì•”í˜¸í™”**: ì „ì†¡ ì‹œ SSL/TLS

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ë°±ì—…
- **ë¹ˆë„**: ë°°í¬ ì „ ìë™
- **ë³´ì¡´ ê¸°ê°„**: 7ì¼
- **í¬í•¨ ë‚´ìš©**: ì½”ë“œ, ì„¤ì •, ì—…ë¡œë“œ íŒŒì¼

#### ë³µì› ì ˆì°¨
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ë³µì›
./backup-database.sh --restore backup-20241231_020000.sql.gz

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡¤ë°±
./deploy-enhanced.sh rollback backup-20241231-020000
```

## ğŸ”„ ë°°í¬ ì‹œìŠ¤í…œ

### ë°°í¬ ì „ëµ

#### ë¬´ì¤‘ë‹¨ ë°°í¬ (Zero-Downtime)
```bash
# ê¸°ë³¸ ë°°í¬ ë°©ì‹
./deploy-enhanced.sh deploy zero-downtime

# íŠ¹ì§•:
# - ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ìŒ
# - Rolling update ë°©ì‹
# - ìë™ í—¬ìŠ¤ì²´í¬
# - ì‹¤íŒ¨ ì‹œ ìë™ ë¡¤ë°±
```

#### ì „í†µì  ë°°í¬
```bash
# ì „í†µì  ë°©ì‹ (ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ë°œìƒ)
./deploy-enhanced.sh deploy traditional

# ì‚¬ìš© ì‹œê¸°:
# - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
# - ì¸í”„ë¼ ë³€ê²½
# - ê¸´ê¸‰ ë³´ì•ˆ íŒ¨ì¹˜
```

### ë°°í¬ íŒŒì´í”„ë¼ì¸

1. **ì‚¬ì „ ê²€ì¦**
   - Prerequisites í™•ì¸
   - ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
   - ë””ìŠ¤í¬ ê³µê°„ í™•ì¸

2. **ë°±ì—…**
   - í˜„ì¬ ë²„ì „ ë°±ì—…
   - ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
   - ì—…ë¡œë“œ íŒŒì¼ ë°±ì—…

3. **ë°°í¬**
   - Git ì½”ë“œ ì—…ë°ì´íŠ¸
   - Docker ì´ë¯¸ì§€ ë¹Œë“œ
   - ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸

4. **ê²€ì¦**
   - í—¬ìŠ¤ì²´í¬
   - ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
   - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸

5. **ì•Œë¦¼**
   - ë°°í¬ ìƒíƒœ í†µë³´
   - ì†Œìš” ì‹œê°„ ê¸°ë¡
   - ì‹¤íŒ¨ ì‹œ ì•Œë¦¼

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. ì„œë¹„ìŠ¤ ì‘ë‹µ ì—†ìŒ
```bash
# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps

# ë¡œê·¸ í™•ì¸
docker-compose logs app

# í—¬ìŠ¤ì²´í¬ ì‹¤í–‰
./health-check.sh
```

#### 2. ë†’ì€ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ 
```bash
# ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸
top
df -h
free -h

# Docker ë¦¬ì†ŒìŠ¤ ì •ë¦¬
docker system prune -af
```

#### 3. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨
```bash
# PostgreSQL ìƒíƒœ í™•ì¸
docker-compose exec postgres pg_isready -U postgres

# ì—°ê²° ìˆ˜ í™•ì¸
docker-compose exec postgres psql -U postgres -c "SELECT count(*) FROM pg_stat_activity;"
```

#### 4. SSL ì¸ì¦ì„œ ë¬¸ì œ
```bash
# ì¸ì¦ì„œ ë§Œë£Œì¼ í™•ì¸
echo | openssl s_client -servername 1001stories.seedsofempowerment.org -connect 1001stories.seedsofempowerment.org:443 2>/dev/null | openssl x509 -noout -dates

# Let's Encrypt ê°±ì‹ 
certbot renew --dry-run
```

### ë¡œê·¸ ìœ„ì¹˜

- **ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸**: `docker-compose logs app`
- **ì‹œìŠ¤í…œ ë¡œê·¸**: `/var/log/syslog`
- **Nginx ë¡œê·¸**: `/var/log/nginx/`
- **PostgreSQL ë¡œê·¸**: `docker-compose logs postgres`
- **ë³´ì•ˆ ë¡œê·¸**: `/var/log/auth.log`, `/var/log/fail2ban.log`
- **ê°ì‚¬ ë¡œê·¸**: `/var/log/audit/audit.log`

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
```sql
-- ì¸ë±ìŠ¤ í™•ì¸
SELECT schemaname, tablename, indexname, idx_scan, idx_tup_read, idx_tup_fetch 
FROM pg_stat_user_indexes 
ORDER BY idx_scan ASC;

-- ëŠë¦° ì¿¼ë¦¬ í™•ì¸
SELECT query, mean_time, calls, total_time 
FROM pg_stat_statements 
ORDER BY mean_time DESC 
LIMIT 10;
```

### ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì œí•œ
```yaml
# docker-compose.ymlì— ì¶”ê°€
services:
  app:
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '1.0'
          memory: 1G
```

## ğŸ” ë³´ì•ˆ ëª¨ë‹ˆí„°ë§

### ì •ê¸° ë³´ì•ˆ ê²€ì‚¬

#### Lynis ì‹œìŠ¤í…œ ê°ì‚¬
```bash
# ì „ì²´ ì‹œìŠ¤í…œ ê°ì‚¬
lynis audit system

# ê²°ê³¼ ê²€í† 
cat /var/log/lynis.log
```

#### ë¬´ê²°ì„± ê²€ì‚¬
```bash
# AIDE íŒŒì¼ ë¬´ê²°ì„± ê²€ì‚¬
aide --check

# ë£¨íŠ¸í‚· ê²€ì‚¬
rkhunter --check
chkrootkit
```

#### ë¡œê·¸ ë¶„ì„
```bash
# ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„
grep "Failed password" /var/log/auth.log | tail -20

# Fail2Ban ìƒíƒœ
fail2ban-client status sshd
```

## ğŸ“ ì§€ì› ë° ì—°ë½ì²˜

### ê¸´ê¸‰ ìƒí™© ëŒ€ì‘
1. **ì„œë¹„ìŠ¤ ë‹¤ìš´**: ì¦‰ì‹œ `./deploy-enhanced.sh rollback` ì‹¤í–‰
2. **ë³´ì•ˆ ì¹¨í•´ ì˜ì‹¬**: ì„œë²„ ê²©ë¦¬ í›„ ë³´ì•ˆíŒ€ ì—°ë½
3. **ë°ì´í„° ì†ì‹¤**: ìµœì‹  ë°±ì—…ì—ì„œ ë³µì›

### ì—°ë½ì²˜
- **ê°œë°œíŒ€**: dev@1001stories.org
- **ìš´ì˜íŒ€**: ops@1001stories.org
- **ë³´ì•ˆíŒ€**: security@1001stories.org
- **ê¸´ê¸‰ ìƒí™©**: +82-XXX-XXXX-XXXX

### ë¬¸ì„œ ë° ìë£Œ
- **ë‚´ë¶€ ìœ„í‚¤**: https://wiki.1001stories.org
- **Runbook**: https://docs.1001stories.org/runbooks/
- **API ë¬¸ì„œ**: https://docs.1001stories.org/api/

---

## ğŸ“ ë³€ê²½ ë¡œê·¸

### v1.0.0 (2025-08-30)
- ì´ˆê¸° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶•
- í—¬ìŠ¤ì²´í¬ ë° ë°±ì—… ìë™í™”
- ë³´ì•ˆ ê°•í™” ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
- ë¬´ì¤‘ë‹¨ ë°°í¬ ì‹œìŠ¤í…œ êµ¬í˜„

---

*ì´ ë¬¸ì„œëŠ” 1001 Stories í”„ë¡œë•ì…˜ í™˜ê²½ì˜ ì•ˆì •ì„±ê³¼ ë³´ì•ˆì„ ìœ„í•´ ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.*